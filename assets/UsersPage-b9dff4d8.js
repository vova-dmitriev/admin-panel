import{j as e,b as w,c as b,d as C,C as xe,B as Z,e as V,f,r as c,g as j,U as je,h as _,i as E,I as q,p as u,k as pe,l as ue,m as $,n as ve,a as Ce,o as fe,q as ge,t as I,v as p,w as Ne,S as Se}from"./index-ebc08a0e.js";const be=({visible:s=!0})=>s?e.jsxs("div",{className:w.loader,children:[e.jsx("div",{className:w.dot}),e.jsx("div",{className:w.dot}),e.jsx("div",{className:w.dot}),e.jsx("div",{className:w.dot}),e.jsx("div",{className:w.dot})]}):null,we=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"4",viewBox:"0 0 20 4",fill:"none",children:[e.jsx("circle",{cx:"2",cy:"2",r:"2",fill:"#C1C1CB"}),e.jsx("circle",{cx:"10",cy:"2",r:"2",fill:"#C1C1CB"}),e.jsx("circle",{cx:"18",cy:"2",r:"2",fill:"#C1C1CB"})]}),ke=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"9",viewBox:"0 0 12 9",fill:"none",children:e.jsx("path",{d:"M1.00006 1.86407L5.86401 6.72803L10.728 1.86407",stroke:"#C1C1CB","stroke-width":"2","stroke-linecap":"round"})}),Oe=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"9",viewBox:"0 0 12 9",fill:"none",children:e.jsx("path",{d:"M1.00006 1.86407L5.86401 6.72803L10.728 1.86407",stroke:"#C1C1CB","stroke-width":"2","stroke-linecap":"round"})}),A=({isOpen:s,title:a,onClose:t,children:n,actions:d,titleClassName:r,showCloseBtn:i=!0})=>e.jsx("div",{className:b(C.overlay,s&&C.overlayOpen),onClick:t,children:e.jsxs("div",{className:b(C.content,s&&C.contentOpen),onClick:o=>o.stopPropagation(),children:[i&&e.jsx("div",{className:C.closeBtn,onClick:t,children:e.jsx(xe,{})}),a&&e.jsx("h2",{className:b(C.title,i&&C.titleLower,r),children:a}),n,e.jsx("div",{className:C.actions,children:d==null?void 0:d.map((o,h)=>e.jsx(Z,{className:b(C.btn,o.className),onClick:o.onClick,buttonType:"primary",...o.props,children:o.label},h))})]})}),Pe=({items:s=[]})=>{const a=(t,n)=>{t.stopPropagation(),!n.disabled&&n.handler()};return e.jsx("div",{className:V.popover,children:s.map(t=>e.jsx("div",{className:b(V.item,t.visible===!1&&V.itemHidden),onClick:n=>a(n,t),children:t.text},t.text))})},ye=({label:s,isChecked:a,onToggle:t})=>e.jsxs("div",{className:f.dropdownItem,onClick:t,children:[e.jsx("input",{type:"checkbox",checked:a,onChange:t}),e.jsx("div",{className:f.checkbox,children:a&&e.jsx(Oe,{})}),e.jsx("div",{children:s})]}),G=({values:s,onChange:a,selectedValues:t=[],placeholder:n="Выберите",className:d,optionToSelectAll:r="Все"})=>{const[i,o]=c.useState(t),[h,g]=c.useState(!1);c.useEffect(()=>()=>{g(!1),o([])},[]);const N=m=>{const v=i.includes(m);if(m.toLowerCase()===r.toLowerCase()){o(v?[]:s);return}const O=v?i.filter(k=>k!==m):[...i,m];o(O)},S=()=>{const m=!h;g(!h),m||a(i)};return e.jsxs("div",{className:b(f.select,d),children:[e.jsxs("div",{className:f.text,onClick:S,children:[!i.length&&e.jsx("div",{className:f.placeholder,children:n}),i.length>0&&e.jsx("span",{className:f.textItem,children:i.filter(m=>m!==r).join(", ")}),e.jsx("div",{className:b(f.arrow,h&&f.arrowUp),children:e.jsx(ke,{})})]}),h&&e.jsx("div",{className:f.dropdown,children:s.map((m,v)=>e.jsx(ye,{label:m,isChecked:i.includes(m),onToggle:()=>N(m)},v))})]})},Me=({user:s,actionItems:a,isPopoverVisible:t,onActionClick:n})=>{const d=r=>{r.stopPropagation(),n()};return e.jsxs("div",{className:j.row,children:[e.jsxs("div",{className:j.left,children:[e.jsx("div",{className:j.avatar,children:s.image?e.jsx("img",{src:s==null?void 0:s.image,alt:s==null?void 0:s.email}):e.jsx(je,{})}),e.jsxs("div",{className:j.info,children:[e.jsxs("div",{className:j.infoTitle,children:[e.jsx("div",{className:j.name,children:s.name}),s.isAuthorized===!1&&e.jsx("div",{className:j.auth,children:"Не авторизирован"}),e.jsx("div",{className:j.email,children:s==null?void 0:s.email})]}),e.jsx("div",{className:j.tags,children:s.permissions.map(r=>e.jsx("div",{className:b(j.tag,_(s)&&j.tagBoss),children:r},r))})]})]}),e.jsxs("div",{className:j.action,onClick:d,children:[e.jsx(we,{}),t&&e.jsx(Pe,{items:a})]})]})},Ee=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,Ie=s=>Ee.test(s),Ae=({visible:s,onClose:a,handleSubmitInvite:t})=>{const[n,d]=c.useState(""),[r,i]=c.useState(""),[o,h]=c.useState([]),g=()=>{if(!Ie(n)){i("Неправильно указан email");return}!n.length||!o.length||(i(""),t({email:n,permissions:o}),N(),h([]))},N=()=>{d(""),h([]),i(""),a()},S=v=>{h(v)},m=["Все",u.MODERATOR,u.BLOG,u.TECH_SUPPORT,u.CUSTOMERS,u.ANALYST,u.STOCK];return e.jsx(A,{isOpen:s,title:"Отправьте приглашение",onClose:N,actions:[{label:"Отправить приглашение",onClick:()=>{g()}}],titleClassName:E.title,children:e.jsx("div",{className:E.content,children:s&&e.jsxs(e.Fragment,{children:[e.jsx(q,{placeholder:"Email",handler:v=>d(v),className:E.input,error:r,value:n}),e.jsx("div",{className:E.select,children:e.jsx(G,{values:m,onChange:S,placeholder:"Выберите права доступа"})})]})})})},Ue=({text:s,visible:a,onClose:t})=>e.jsx(A,{isOpen:a,onClose:t,actions:[{label:"Закрыть",onClick:t}],showCloseBtn:!1,children:e.jsx("div",{className:pe.text,children:s})}),Le=({text:s,visible:a,onClose:t,onSubmit:n})=>e.jsx(A,{isOpen:a,onClose:t,actions:[{label:"Удалить",onClick:n,props:{buttonType:"danger"}},{label:"Закрыть",onClick:t}],children:e.jsx("div",{className:ue.text,children:s})}),Te=({visible:s,onClose:a,onSubmit:t,selectedUser:n})=>{const[d,r]=c.useState((n==null?void 0:n.permissions)||[]),i=()=>{t(d),o(),r([])},o=()=>{r([]),a()},h=N=>{r(N)},g=["Все",u.MODERATOR,u.BLOG,u.TECH_SUPPORT,u.CUSTOMERS,u.ANALYST,u.STOCK];return e.jsx(A,{isOpen:s,title:"Изменить права доступа",onClose:o,actions:[{label:"Сохранить",onClick:()=>{i()}}],titleClassName:$.title,children:e.jsx("div",{className:$.content,children:e.jsx("div",{className:$.select,children:s&&e.jsx(G,{values:g,selectedValues:d,onChange:h,placeholder:"Выберите права доступа"})})})})},Re=()=>{const{getUsers:s,statuses:a,users:t,isLoading:n,sendInvite:d,removeUser:r,resetStatuses:i,changeUserPermissions:o}=ve(),{user:h}=Ce(),{changeSidebarVisible:g,isSidebarVisible:N}=fe(),S=ge(),[m,v]=c.useState(S),[O,k]=c.useState(t),[D,z]=c.useState({}),[K,H]=c.useState(!1),[Y,U]=c.useState(!1),[F,P]=c.useState(!1),[J,L]=c.useState(""),[Q,W]=c.useState(""),[y,X]=c.useState(),[ee,T]=c.useState(!1),[x,B]=c.useState(null),R=h&&_(h);c.useEffect(()=>{i()},[i]),c.useEffect(()=>{s()},[s]),c.useEffect(()=>{k(t)},[t]),c.useEffect(()=>{v(S)},[S]),c.useEffect(()=>{a.sendInvite===I.success&&(L(`Приглашение отправлено на почту ${(y==null?void 0:y.email)||(x==null?void 0:x.email)}`),P(!0),i()),a.removeUser===I.success&&(L("Пользователь успешно удален "),P(!0),i()),a.changeUserPermissions===I.success&&(L("Изменены права доступа"),P(!0),i())},[a,i,y,x]);const se=l=>{if(W(l),!l){k(t);return}const me=t.filter(he=>he.email.toLowerCase().includes(l.toLowerCase()));k(me)},te=()=>{H(!0)},le=l=>{B(l),U(!0)},ae=l=>{B(l),d({email:l.email,permissions:l.permissions,needAddUser:!1})},ie=l=>{B(l),T(!0)},ne=()=>{x&&r(x),T(!1)},ce=l=>{z({[l.email]:!D[l.email]})},oe=l=>{X(l),d({email:l.email,permissions:l.permissions,needAddUser:!0})},re=l=>{x&&o(x,l),U(!1)},M=()=>{z({})},de=l=>[{text:"Изменить права доступа",disabled:!R,handler:()=>{le(l),M()}},{text:"Отправить код повторно",disabled:!R,handler:()=>{ae(l),M()},visible:l.isAuthorized===!1},{text:"Удалить",disabled:!R,handler:()=>{ie(l),M()}}];return e.jsxs("div",{className:p.wrapper,onClick:M,children:[e.jsx(be,{visible:a.getUsers===I.loading}),e.jsxs("div",{className:p.content,children:[e.jsxs("div",{className:p.header,children:[e.jsxs("div",{className:p.headerLeft,children:[S&&e.jsx("div",{className:p.burger,onClick:()=>g(!N),children:e.jsx(Ne,{})}),e.jsx("div",{className:p.title,children:"Команда"})]}),e.jsxs("div",{className:p.headerRight,children:[m?e.jsx(q,{search:!0,handler:se,placeholder:"Поиск по Email",className:p.input,value:Q,clearable:!0}):e.jsx("div",{className:p.inputIcon,onClick:()=>v(!0),children:e.jsx(Se,{})}),e.jsx(Z,{buttonType:"primary",type:"submit",className:p.btn,onClick:te,children:"Добавить пользователя"})]})]}),e.jsxs("div",{className:p.command,children:[!O.length&&!n&&e.jsx("div",{className:p.empty,children:"Здесь пусто..."}),O.map(l=>e.jsx(Me,{user:l,actionItems:de(l),isPopoverVisible:!!D[l.email],onActionClick:()=>ce(l)},l.email))]})]}),e.jsx(Ae,{visible:K,onClose:()=>H(!1),handleSubmitInvite:oe}),e.jsx(Te,{visible:Y,onClose:()=>U(!1),onSubmit:re,selectedUser:x}),e.jsx(Ue,{visible:F,onClose:()=>P(!1),text:J}),e.jsx(Le,{visible:ee,onClose:()=>T(!1),onSubmit:ne,text:`Вы действительно хотите удалить пользователя ${x==null?void 0:x.name}?`})]})};export{Re as UsersPage,Re as default};
